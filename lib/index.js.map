{"version":3,"sources":["../src/index.js"],"names":["Index","config","obj","Object","assign","onDataChange","bind","flow","init","drawFlow","data","nodes","links","reset","e","length","forEach","node","addNode","selected","selectNode","id","link","addLink","Nodes","from","to","nodeID","nodeInfo","sourceNode","targetNode","nodesID","keys","map","x","Math","floor","y","getNodes","getLinks","onChange","Links","linksID","genUUID"],"mappings":"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","file":"index.js","sourcesContent":["import Flow from './topoflow';\nimport common from './lib/common';\n// 封装外暴露的方法\nclass Index {\n    constructor(config) {\n        let obj = {};\n        Object.assign(obj, config);\n\n        this.config = obj;\n\n        obj.onDataChange = this.onDataChange.bind(this);\n\n        this.flow = new Flow(obj);\n        this.flow.init();\n        this.drawFlow(this.config.data);\n    }\n\n    // 设置数据\n    setData(data) {\n        this.config.data = data;\n        this.drawFlow(data);\n    }\n\n    // 渲染图形\n    drawFlow() {\n        let nodes = [];\n        let links = [];\n        this.flow.reset();\n        \n        try {\n            nodes = this.config.data.nodes;\n            links = this.config.data.links;\n        } catch (e) {\n            return false;\n        }\n\n        if (!!nodes && nodes.length > 0) {\n            nodes.forEach((node) => {\n                this.flow.addNode(node);\n                if (node.selected) {\n                    this.selectNode(node.id);\n                }\n            });\n        }\n\n        // 渲染链接\n        if (!!links && links.length > 0) {\n            links.forEach((link) => {\n                this.flow.addLink(this.flow.Nodes[link.from], this.flow.Nodes[link.to]);\n            });\n        }\n    }\n\n    // 选中一个节点\n    selectNode(nodeID) {\n        this.flow.selectNode(nodeID);\n    }\n\n    // 新增节点\n    addNode(nodeInfo) {\n        return this.flow.addNode(nodeInfo);\n    }\n\n    // 新增线条\n    addLink(sourceNode, targetNode) {\n        this.flow.addLink(sourceNode, targetNode);\n    }\n\n    getNodes() {\n        let nodes = this.flow.Nodes;\n        let nodesID = Object.keys(nodes);\n        return nodesID.map((id) => {\n            nodes[id].x = Math.floor(nodes[id].x);\n            nodes[id].y = Math.floor(nodes[id].y);\n            return nodes[id];\n        });\n    }\n\n    onDataChange() {\n        let nodes = this.getNodes();\n        let links = this.getLinks();\n\n        if (!!this.config.onChange) {\n            this.config.onChange({\n                nodes,\n                links\n            });\n        }\n    }\n\n    getLinks() {\n        let links = this.flow.Links;\n        let linksID = Object.keys(links);\n        return linksID.map((id) => {\n            return links[id];\n        });\n    }\n\n    genUUID() {\n        return common.genUUID();\n    }\n}\nexport default Index;\n"]}